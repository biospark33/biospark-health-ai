"use strict";(()=>{var e={};e.id=356,e.ids=[356],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},72714:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>D,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var r={};a.r(r),a.d(r,{GET:()=>d,POST:()=>g});var s=a(49303),n=a(88716),o=a(60670),i=a(87070),p=a(87907),u=a(14749);async function c(e){try{let{searchParams:t}=new URL(e.url),a={userId:t.get("userId")||void 0,eventType:t.get("eventType")||void 0,resource:t.get("resource")||void 0,startDate:t.get("startDate")||void 0,endDate:t.get("endDate")||void 0,riskLevel:t.get("riskLevel")||void 0,page:parseInt(t.get("page")||"1"),limit:Math.min(parseInt(t.get("limit")||"50"),100)},r={...a,startDate:a.startDate?new Date(a.startDate):void 0,endDate:a.endDate?new Date(a.endDate):void 0,offset:((a.page||1)-1)*(a.limit||50)},s=await u.Ps.queryAuditLogs(r),n=s.length,o=Math.ceil(n/(a.limit||50));return i.NextResponse.json({success:!0,data:{logs:s,pagination:{page:a.page||1,limit:a.limit||50,totalCount:n,totalPages:o,hasNext:(a.page||1)<o,hasPrev:(a.page||1)>1}}})}catch(e){return console.error("Audit logs query failed:",e),i.NextResponse.json({success:!1,error:"Failed to retrieve audit logs"},{status:500})}}async function l(e){try{let{searchParams:t}=new URL(e.url),a=new Date(t.get("startDate")?t.get("startDate"):Date.now()-2592e6),r=t.get("endDate")?new Date(t.get("endDate")):new Date,s=await u.Ps.generateComplianceReport(a,r);return i.NextResponse.json({success:!0,data:s})}catch(e){return console.error("Compliance report generation failed:",e),i.NextResponse.json({success:!1,error:"Failed to generate compliance report"},{status:500})}}let d=(0,p.Sk)(async e=>{let{searchParams:t}=new URL(e.url);return"report"===t.get("type")?l(e):c(e)}),g=(0,p.Sk)(async e=>{try{let t;let{exportType:a,filters:r,format:s="json"}=await e.json();if(!a||!["audit_logs","compliance_report"].includes(a))return i.NextResponse.json({success:!1,error:"Invalid export type"},{status:400});if("audit_logs"===a)t=await u.Ps.queryAuditLogs(r);else{let e=new Date(r.startDate?r.startDate:Date.now()-2592e6),a=r.endDate?new Date(r.endDate):new Date;t=await u.Ps.generateComplianceReport(e,a)}let n=e.userContext;if(await u.Ps.logDataExport(n.userId,a,["compliance_data"],e,!0),"csv"===s){let e=JSON.stringify(t);return new i.NextResponse(e,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="${a}_${Date.now()}.csv"`}})}return i.NextResponse.json({success:!0,data:t,exportInfo:{type:a,format:s,timestamp:new Date().toISOString(),recordCount:Array.isArray(t)?t.length:1}})}catch(e){return console.error("Compliance data export failed:",e),i.NextResponse.json({success:!1,error:"Failed to export compliance data"},{status:500})}}),m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/compliance/audit-logs/route",pathname:"/api/compliance/audit-logs",filename:"route",bundlePath:"app/api/compliance/audit-logs/route"},resolvedPagePath:"/home/ubuntu/labinsight-ai-complete/app/api/compliance/audit-logs/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:D,staticGenerationAsyncStorage:v,serverHooks:x}=m,w="/api/compliance/audit-logs/route";function y(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972,907],()=>a(72714));module.exports=r})();