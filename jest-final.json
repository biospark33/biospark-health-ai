{"numFailedTestSuites":6,"numFailedTests":15,"numPassedTestSuites":1,"numPassedTests":47,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":7,"numTotalTests":62,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1753378491935,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["Zep Integration Tests","ZepClient"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests ZepClient should create user session successfully","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should create user session successfully"},{"ancestorTitles":["Zep Integration Tests","ZepClient"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests ZepClient should store health analysis memory with encryption","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should store health analysis memory with encryption"},{"ancestorTitles":["Zep Integration Tests","ZepClient"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests ZepClient should retrieve relevant context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should retrieve relevant context"},{"ancestorTitles":["Zep Integration Tests","ZepClient"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests ZepClient should test connection successfully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should test connection successfully"},{"ancestorTitles":["Zep Integration Tests","MemoryManager"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests MemoryManager should store health analysis with HIPAA compliance","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should store health analysis with HIPAA compliance"},{"ancestorTitles":["Zep Integration Tests","MemoryManager"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests MemoryManager should retrieve relevant memory context","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should retrieve relevant memory context"},{"ancestorTitles":["Zep Integration Tests","MemoryManager"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests MemoryManager should create or get user session","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should create or get user session"},{"ancestorTitles":["Zep Integration Tests","MemoryManager"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests MemoryManager should get user health journey","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should get user health journey"},{"ancestorTitles":["Zep Integration Tests","SessionManager"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests SessionManager should create user session","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should create user session"},{"ancestorTitles":["Zep Integration Tests","SessionManager"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests SessionManager should get active session","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"should get active session"},{"ancestorTitles":["Zep Integration Tests","SessionManager"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: sessionManager.validateSessionFromRequest is not a function\n    at Object.validateSessionFromRequest (/home/ubuntu/biospark-health-ai/__tests__/zep-integration.test.ts:158:47)\n    at Promise.then.completed (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/ubuntu/biospark-health-ai/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/ubuntu/biospark-health-ai/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Zep Integration Tests SessionManager should validate session","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should validate session"},{"ancestorTitles":["Zep Integration Tests","SessionManager"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests SessionManager should cleanup expired sessions","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should cleanup expired sessions"},{"ancestorTitles":["Zep Integration Tests","SessionManager"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests SessionManager should get session statistics","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should get session statistics"},{"ancestorTitles":["Zep Integration Tests","HIPAA Compliance"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests HIPAA Compliance should encrypt and decrypt PHI data","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should encrypt and decrypt PHI data"},{"ancestorTitles":["Zep Integration Tests","HIPAA Compliance"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests HIPAA Compliance should validate HIPAA compliance","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should validate HIPAA compliance"},{"ancestorTitles":["Zep Integration Tests","Error Handling"],"duration":2,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"createdAt\": 2025-07-24T17:34:52.632Z, \"expiresAt\": 2025-07-25T17:34:52.632Z, \"id\": \"session-test-user-123-1753378492632\", \"isActive\": true, \"metadata\": {}, \"sessionId\": \"labinsight_session_test-user-123_0bbff97c6157fe1b\", \"userId\": \"test-user-123\"}"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"createdAt\": 2025-07-24T17:34:52.632Z, \"expiresAt\": 2025-07-25T17:34:52.632Z, \"id\": \"session-test-user-123-1753378492632\", \"isActive\": true, \"metadata\": {}, \"sessionId\": \"labinsight_session_test-user-123_0bbff97c6157fe1b\", \"userId\": \"test-user-123\"}\n    at expect (/home/ubuntu/biospark-health-ai/node_modules/expect/build/index.js:113:15)\n    at Object.expect (/home/ubuntu/biospark-health-ai/__tests__/zep-integration.test.ts:250:13)\n    at Promise.then.completed (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/ubuntu/biospark-health-ai/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/ubuntu/biospark-health-ai/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/ubuntu/biospark-health-ai/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Zep Integration Tests Error Handling should handle Zep API errors gracefully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle Zep API errors gracefully"},{"ancestorTitles":["Zep Integration Tests","Error Handling"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests Error Handling should handle network timeouts","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle network timeouts"},{"ancestorTitles":["Zep Integration Tests","Performance"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests Performance should handle large memory contexts efficiently","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle large memory contexts efficiently"},{"ancestorTitles":["Zep Integration Tests","Performance"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Zep Integration Tests Performance should handle concurrent session operations","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"should handle concurrent session operations"},{"ancestorTitles":["Full Zep Integration Workflow"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Full Zep Integration Workflow should complete full health analysis memory workflow","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should complete full health analysis memory workflow"}],"endTime":1753378492657,"message":"  ● Zep Integration Tests › SessionManager › should validate session\n\n    TypeError: sessionManager.validateSessionFromRequest is not a function\n\n      156 |       } as any;\n      157 |\n    > 158 |       const validation = await sessionManager.validateSessionFromRequest(mockRequest);\n          |                                               ^\n      159 |       \n      160 |       expect(validation).toHaveProperty('valid');\n      161 |       expect(typeof validation.valid).toBe('boolean');\n\n      at Object.validateSessionFromRequest (__tests__/zep-integration.test.ts:158:47)\n\n  ● Zep Integration Tests › Error Handling › should handle Zep API errors gracefully\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: {\"createdAt\": 2025-07-24T17:34:52.632Z, \"expiresAt\": 2025-07-25T17:34:52.632Z, \"id\": \"session-test-user-123-1753378492632\", \"isActive\": true, \"metadata\": {}, \"sessionId\": \"labinsight_session_test-user-123_0bbff97c6157fe1b\", \"userId\": \"test-user-123\"}\n\n      248 |       }));\n      249 |\n    > 250 |       await expect(\n          |             ^\n      251 |         sessionManagerWithFailingPrisma.createUserSession('test-user-123')\n      252 |       ).rejects.toThrow('Failed to create user session');\n      253 |     });\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at Object.expect (__tests__/zep-integration.test.ts:250:13)\n","name":"/home/ubuntu/biospark-health-ai/__tests__/zep-integration.test.ts","startTime":1753378492036,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["BMAD Phase 1 Integration Tests","Memory-Enhanced Health Analysis"],"duration":18,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeDefined()\n\nReceived: undefined","pass":false}}],"failureMessages":["Error: expect(received).toBeDefined()\n\nReceived: undefined\n    at Object.toBeDefined (/home/ubuntu/biospark-health-ai/tests/phase1-integration.test.ts:168:56)"],"fullName":"BMAD Phase 1 Integration Tests Memory-Enhanced Health Analysis should generate memory-aware insights successfully","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"failed","title":"should generate memory-aware insights successfully"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Memory-Enhanced Health Analysis"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Memory-Enhanced Health Analysis should handle memory retrieval failures gracefully","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle memory retrieval failures gracefully"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Memory-Enhanced Health Analysis"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Memory-Enhanced Health Analysis should analyze engagement patterns correctly","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should analyze engagement patterns correctly"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Progressive Disclosure Integration"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Progressive Disclosure Integration should track layer navigation correctly","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should track layer navigation correctly"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Progressive Disclosure Integration"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Progressive Disclosure Integration should calculate engagement scores accurately","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should calculate engagement scores accurately"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Memory Personalization"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Memory Personalization should generate personalized insights based on user history","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should generate personalized insights based on user history"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Memory Personalization"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Memory Personalization should predict engagement patterns accurately","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should predict engagement patterns accurately"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Database Integration"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Database Integration should create health assessment with memory enhancement","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should create health assessment with memory enhancement"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Database Integration"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Database Integration should update user memory preferences automatically","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should update user memory preferences automatically"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","API Integration"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests API Integration should handle memory-enhanced analysis API requests","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle memory-enhanced analysis API requests"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","API Integration"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests API Integration should handle engagement tracking API requests","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle engagement tracking API requests"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Error Handling & Resilience"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Error Handling & Resilience should handle Zep API failures gracefully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle Zep API failures gracefully"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Error Handling & Resilience"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Error Handling & Resilience should provide fallback when memory enhancement fails","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should provide fallback when memory enhancement fails"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Performance & Scalability"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Performance & Scalability should handle concurrent analysis requests","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"should handle concurrent analysis requests"},{"ancestorTitles":["BMAD Phase 1 Integration Tests","Performance & Scalability"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"BMAD Phase 1 Integration Tests Performance & Scalability should limit memory search results appropriately","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should limit memory search results appropriately"}],"endTime":1753378492978,"message":"  ● BMAD Phase 1 Integration Tests › Memory-Enhanced Health Analysis › should generate memory-aware insights successfully\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n      166 |       // Verify memory context has expected structure\n      167 |       expect(result.memoryContext.userId).toBe(userId);\n    > 168 |       expect(result.memoryContext.previousAssessments).toBeDefined();\n          |                                                        ^\n      169 |       expect(result.memoryContext.engagementPatterns).toBeDefined();\n      170 |       expect(result.memoryContext.preferences).toBeDefined();\n      171 |       expect(result.memoryContext.healthGoals).toBeDefined();\n\n      at Object.toBeDefined (tests/phase1-integration.test.ts:168:56)\n","name":"/home/ubuntu/biospark-health-ai/tests/phase1-integration.test.ts","startTime":1753378492682,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Zep Context Management","getIntelligentContext"],"duration":2,"failureDetails":[{}],"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nMatcher error: received value must have a length property whose value must be a number\n\nReceived has value: undefined\n    at Object.toHaveLength (/home/ubuntu/biospark-health-ai/__tests__/memory/context.test.ts:54:44)"],"fullName":"Zep Context Management getIntelligentContext should retrieve comprehensive health context","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"should retrieve comprehensive health context"},{"ancestorTitles":["Zep Context Management","getIntelligentContext"],"duration":0,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at Object.toHaveBeenCalled (/home/ubuntu/biospark-health-ai/__tests__/memory/context.test.ts:78:31)"],"fullName":"Zep Context Management getIntelligentContext should handle context summarization for long content","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle context summarization for long content"},{"ancestorTitles":["Zep Context Management","updateConversationContext"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"content\": \"What do my lab results mean?\", \"role\": \"user\"}, ObjectContaining {\"content\": \"Your results show good overall health with some areas for improvement.\", \"role\": \"assistant\"}]}\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"content\": \"What do my lab results mean?\", \"role\": \"user\"}, ObjectContaining {\"content\": \"Your results show good overall health with some areas for improvement.\", \"role\": \"assistant\"}]}\n\nNumber of calls: 0\n    at Object.toHaveBeenCalledWith (/home/ubuntu/biospark-health-ai/__tests__/memory/context.test.ts:97:36)"],"fullName":"Zep Context Management updateConversationContext should store conversation messages successfully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should store conversation messages successfully"}],"endTime":1753378493260,"message":"  ● Zep Context Management › getIntelligentContext › should retrieve comprehensive health context\n\n    expect(received).toHaveLength(expected)\n\n    Matcher error: received value must have a length property whose value must be a number\n\n    Received has value: undefined\n\n      52 |       expect(result.success).toBe(true);\n      53 |       expect(result.data?.userId).toBe(mockUserId);\n    > 54 |       expect(result.data?.relevantHistory).toHaveLength(1);\n         |                                            ^\n      55 |       expect(result.data?.userPreferences.focusAreas).toContain('cardiovascular');\n      56 |       expect(result.data?.healthGoals).toContain('Improve heart health');\n      57 |     });\n\n      at Object.toHaveLength (__tests__/memory/context.test.ts:54:44)\n\n  ● Zep Context Management › getIntelligentContext › should handle context summarization for long content\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      76 |       );\n      77 |\n    > 78 |       expect(summarizeMemory).toHaveBeenCalled();\n         |                               ^\n      79 |       expect(result.data?.conversationSummary).toBe('Summarized content');\n      80 |     });\n      81 |   });\n\n      at Object.toHaveBeenCalled (__tests__/memory/context.test.ts:78:31)\n\n  ● Zep Context Management › updateConversationContext › should store conversation messages successfully\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"content\": \"What do my lab results mean?\", \"role\": \"user\"}, ObjectContaining {\"content\": \"Your results show good overall health with some areas for improvement.\", \"role\": \"assistant\"}]}\n\n    Number of calls: 0\n\n       95 |\n       96 |       expect(result.success).toBe(true);\n    >  97 |       expect(zepClient.memory.add).toHaveBeenCalledWith(\n          |                                    ^\n       98 |         mockSessionId,\n       99 |         expect.objectContaining({\n      100 |           messages: expect.arrayContaining([\n\n      at Object.toHaveBeenCalledWith (__tests__/memory/context.test.ts:97:36)\n","name":"/home/ubuntu/biospark-health-ai/__tests__/memory/context.test.ts","startTime":1753378493000,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Zep Preferences Management","storePreferences"],"duration":4,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"content\": \"{\\\"healthGoals\\\":[\\\"weight_loss\\\",\\\"energy_improvement\\\"],\\\"focusAreas\\\":[\\\"cardiovascular\\\",\\\"metabolic\\\"],\\\"communicationStyle\\\":\\\"detailed\\\",\\\"reminderFrequency\\\":\\\"weekly\\\",\\\"privacyLevel\\\":\\\"standard\\\",\\\"rayPeatFocus\\\":true,\\\"bioenergetic\\\":true}\", \"metadata\": ObjectContaining {\"type\": \"preferences\", \"userId\": \"test-user-123\", \"version\": \"2.0\"}, \"role\": \"system\"}]}\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"content\": \"{\\\"healthGoals\\\":[\\\"weight_loss\\\",\\\"energy_improvement\\\"],\\\"focusAreas\\\":[\\\"cardiovascular\\\",\\\"metabolic\\\"],\\\"communicationStyle\\\":\\\"detailed\\\",\\\"reminderFrequency\\\":\\\"weekly\\\",\\\"privacyLevel\\\":\\\"standard\\\",\\\"rayPeatFocus\\\":true,\\\"bioenergetic\\\":true}\", \"metadata\": ObjectContaining {\"type\": \"preferences\", \"userId\": \"test-user-123\", \"version\": \"2.0\"}, \"role\": \"system\"}]}\n\nNumber of calls: 0\n    at Object.toHaveBeenCalledWith (/home/ubuntu/biospark-health-ai/__tests__/memory/preferences.test.ts:52:36)"],"fullName":"Zep Preferences Management storePreferences should store user preferences successfully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should store user preferences successfully"},{"ancestorTitles":["Zep Preferences Management","getPreferences"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Preferences Management getPreferences should retrieve user preferences successfully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should retrieve user preferences successfully"},{"ancestorTitles":["Zep Preferences Management","getPreferences"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeNull()\n\nReceived: {\"communicationStyle\": \"concise\", \"focusAreas\": [\"thyroid\"], \"healthGoals\": [\"energy_improvement\"]}","pass":false}}],"failureMessages":["Error: expect(received).toBeNull()\n\nReceived: {\"communicationStyle\": \"concise\", \"focusAreas\": [\"thyroid\"], \"healthGoals\": [\"energy_improvement\"]}\n    at Object.toBeNull (/home/ubuntu/biospark-health-ai/__tests__/memory/preferences.test.ts:101:27)"],"fullName":"Zep Preferences Management getPreferences should return null when no preferences found","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should return null when no preferences found"},{"ancestorTitles":["Zep Preferences Management","implicitLearn"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"metadata\": ObjectContaining {\"action\": \"view_analysis\", \"response\": \"positive\", \"type\": \"implicit_learning\"}}]}\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"metadata\": ObjectContaining {\"action\": \"view_analysis\", \"response\": \"positive\", \"type\": \"implicit_learning\"}}]}\n\nNumber of calls: 0\n    at Object.toHaveBeenCalledWith (/home/ubuntu/biospark-health-ai/__tests__/memory/preferences.test.ts:127:36)"],"fullName":"Zep Preferences Management implicitLearn should learn from positive user interactions","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should learn from positive user interactions"},{"ancestorTitles":["Zep Preferences Management","getPersonalizedRecommendations"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Preferences Management getPersonalizedRecommendations should generate recommendations based on preferences and learning","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should generate recommendations based on preferences and learning"},{"ancestorTitles":["Zep Preferences Management","getPersonalizedRecommendations"],"duration":1,"failureDetails":[{"matcherResult":{"actual":false,"expected":true,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false\n    at Object.toBe (/home/ubuntu/biospark-health-ai/__tests__/memory/preferences.test.ts:181:102)"],"fullName":"Zep Preferences Management getPersonalizedRecommendations should provide default recommendations when no data available","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"should provide default recommendations when no data available"}],"endTime":1753378493528,"message":"  ● Zep Preferences Management › storePreferences › should store user preferences successfully\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"content\": \"{\\\"healthGoals\\\":[\\\"weight_loss\\\",\\\"energy_improvement\\\"],\\\"focusAreas\\\":[\\\"cardiovascular\\\",\\\"metabolic\\\"],\\\"communicationStyle\\\":\\\"detailed\\\",\\\"reminderFrequency\\\":\\\"weekly\\\",\\\"privacyLevel\\\":\\\"standard\\\",\\\"rayPeatFocus\\\":true,\\\"bioenergetic\\\":true}\", \"metadata\": ObjectContaining {\"type\": \"preferences\", \"userId\": \"test-user-123\", \"version\": \"2.0\"}, \"role\": \"system\"}]}\n\n    Number of calls: 0\n\n      50 |\n      51 |       expect(result.success).toBe(true);\n    > 52 |       expect(zepClient.memory.add).toHaveBeenCalledWith(\n         |                                    ^\n      53 |         mockSessionId,\n      54 |         expect.objectContaining({\n      55 |           messages: expect.arrayContaining([\n\n      at Object.toHaveBeenCalledWith (__tests__/memory/preferences.test.ts:52:36)\n\n  ● Zep Preferences Management › getPreferences › should return null when no preferences found\n\n    expect(received).toBeNull()\n\n    Received: {\"communicationStyle\": \"concise\", \"focusAreas\": [\"thyroid\"], \"healthGoals\": [\"energy_improvement\"]}\n\n       99 |\n      100 |       expect(result.success).toBe(true);\n    > 101 |       expect(result.data).toBeNull();\n          |                           ^\n      102 |     });\n      103 |   });\n      104 |\n\n      at Object.toBeNull (__tests__/memory/preferences.test.ts:101:27)\n\n  ● Zep Preferences Management › implicitLearn › should learn from positive user interactions\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"test-session-456\", ObjectContaining {\"messages\": ArrayContaining [ObjectContaining {\"metadata\": ObjectContaining {\"action\": \"view_analysis\", \"response\": \"positive\", \"type\": \"implicit_learning\"}}]}\n\n    Number of calls: 0\n\n      125 |\n      126 |       expect(result.success).toBe(true);\n    > 127 |       expect(zepClient.memory.add).toHaveBeenCalledWith(\n          |                                    ^\n      128 |         mockSessionId,\n      129 |         expect.objectContaining({\n      130 |           messages: expect.arrayContaining([\n\n      at Object.toHaveBeenCalledWith (__tests__/memory/preferences.test.ts:127:36)\n\n  ● Zep Preferences Management › getPersonalizedRecommendations › should provide default recommendations when no data available\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n      179 |       expect(result.success).toBe(true);\n      180 |       expect(result.data.some((item: string) => item.includes('Set up your health goals'))).toBe(true);\n    > 181 |       expect(result.data.some((item: string) => item.includes('Complete a comprehensive analysis'))).toBe(true);\n          |                                                                                                      ^\n      182 |     });\n      183 |   });\n      184 | });\n\n      at Object.toBe (__tests__/memory/preferences.test.ts:181:102)\n","name":"/home/ubuntu/biospark-health-ai/__tests__/memory/preferences.test.ts","startTime":1753378493263,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Zep Memory Integration"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Zep Memory Integration Zep API connectivity","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"Zep API connectivity"},{"ancestorTitles":["Zep Memory Integration"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Memory Integration Create user session","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"Create user session"},{"ancestorTitles":["Zep Memory Integration"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Memory Integration Get or create user session","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"Get or create user session"},{"ancestorTitles":["Zep Memory Integration"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Zep Memory Integration Store health analysis in memory","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"Store health analysis in memory"},{"ancestorTitles":["Zep Memory Integration"],"duration":2,"failureDetails":[{"matcherResult":{"actual":"test-user-123","expected":"test_user_1753378493781","message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: \"test_user_1753378493781\"\nReceived: \"test-user-123\"","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"test_user_1753378493781\"\nReceived: \"test-user-123\"\n    at Object.toBe (/home/ubuntu/biospark-health-ai/tests/zep.test.ts:82:35)"],"fullName":"Zep Memory Integration Retrieve health context from memory","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"Retrieve health context from memory"}],"endTime":1753378493792,"message":"  ● Zep Memory Integration › Retrieve health context from memory\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"test_user_1753378493781\"\n    Received: \"test-user-123\"\n\n      80 |       expect(result.success).toBe(true);\n      81 |       expect(result.data).toBeDefined();\n    > 82 |       expect(result.data?.userId).toBe(testUserId);\n         |                                   ^\n      83 |       expect(result.data?.sessionId).toBe(testSessionId);\n      84 |       expect(Array.isArray(result.data?.relevantHistory)).toBe(true);\n      85 |     }\n\n      at Object.toBe (tests/zep.test.ts:82:35)\n","name":"/home/ubuntu/biospark-health-ai/tests/zep.test.ts","startTime":1753378493532,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Zep Search Operations","semanticSearch"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Zep Search Operations semanticSearch should perform semantic search successfully","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should perform semantic search successfully"},{"ancestorTitles":["Zep Search Operations","semanticSearch"],"duration":1,"failureDetails":[{"matcherResult":{"actual":true,"expected":false,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.toBe (/home/ubuntu/biospark-health-ai/__tests__/memory/search.test.ts:80:30)"],"fullName":"Zep Search Operations semanticSearch should handle search errors gracefully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle search errors gracefully"},{"ancestorTitles":["Zep Search Operations","semanticSearch"],"duration":1,"failureDetails":[{"matcherResult":{"actual":true,"expected":false,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.toBe (/home/ubuntu/biospark-health-ai/__tests__/memory/search.test.ts:95:30)"],"fullName":"Zep Search Operations semanticSearch should handle missing Zep client","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle missing Zep client"},{"ancestorTitles":["Zep Search Operations","searchHealthAnalyses"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"limit\": 10, \"metadata\": ObjectContaining {\"analysisType\": \"comprehensive\", \"type\": \"health_analysis\", \"userId\": \"test-user-123\"}, \"text\": \"health analysis biomarkers recommendations\"}\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"limit\": 10, \"metadata\": ObjectContaining {\"analysisType\": \"comprehensive\", \"type\": \"health_analysis\", \"userId\": \"test-user-123\"}, \"text\": \"health analysis biomarkers recommendations\"}\n\nNumber of calls: 0\n    at Object.toHaveBeenCalledWith (/home/ubuntu/biospark-health-ai/__tests__/memory/search.test.ts:113:26)"],"fullName":"Zep Search Operations searchHealthAnalyses should search for specific analysis types","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should search for specific analysis types"},{"ancestorTitles":["Zep Search Operations","findRelevantContext"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"limit\": 5, \"metadata\": ObjectContaining {\"type\": {\"$in\": [\"health_analysis\", \"preferences\", \"goals\"]}, \"userId\": \"test-user-123\"}, \"text\": \"blood pressure concerns\"}\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"test-session-456\", ObjectContaining {\"limit\": 5, \"metadata\": ObjectContaining {\"type\": {\"$in\": [\"health_analysis\", \"preferences\", \"goals\"]}, \"userId\": \"test-user-123\"}, \"text\": \"blood pressure concerns\"}\n\nNumber of calls: 0\n    at Object.toHaveBeenCalledWith (/home/ubuntu/biospark-health-ai/__tests__/memory/search.test.ts:152:26)"],"fullName":"Zep Search Operations findRelevantContext should find context for current query","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should find context for current query"}],"endTime":1753378494063,"message":"  ● Zep Search Operations › semanticSearch › should handle search errors gracefully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n      78 |       );\n      79 |\n    > 80 |       expect(result.success).toBe(false);\n         |                              ^\n      81 |       expect(result.error?.code).toBe('CLIENT_NOT_AVAILABLE');\n      82 |     });\n      83 |\n\n      at Object.toBe (__tests__/memory/search.test.ts:80:30)\n\n  ● Zep Search Operations › semanticSearch › should handle missing Zep client\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n      93 |       );\n      94 |\n    > 95 |       expect(result.success).toBe(false);\n         |                              ^\n      96 |       expect(result.error?.message).toContain('Semantic search failed');\n      97 |     });\n      98 |   });\n\n      at Object.toBe (__tests__/memory/search.test.ts:95:30)\n\n  ● Zep Search Operations › searchHealthAnalyses › should search for specific analysis types\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"test-session-456\", ObjectContaining {\"limit\": 10, \"metadata\": ObjectContaining {\"analysisType\": \"comprehensive\", \"type\": \"health_analysis\", \"userId\": \"test-user-123\"}, \"text\": \"health analysis biomarkers recommendations\"}\n\n    Number of calls: 0\n\n      111 |\n      112 |       // The function calls semanticSearch internally, so we check the mock was called\n    > 113 |       expect(mockSearch).toHaveBeenCalledWith(\n          |                          ^\n      114 |         mockSessionId,\n      115 |         expect.objectContaining({\n      116 |           text: 'health analysis biomarkers recommendations',\n\n      at Object.toHaveBeenCalledWith (__tests__/memory/search.test.ts:113:26)\n\n  ● Zep Search Operations › findRelevantContext › should find context for current query\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"test-session-456\", ObjectContaining {\"limit\": 5, \"metadata\": ObjectContaining {\"type\": {\"$in\": [\"health_analysis\", \"preferences\", \"goals\"]}, \"userId\": \"test-user-123\"}, \"text\": \"blood pressure concerns\"}\n\n    Number of calls: 0\n\n      150 |\n      151 |       expect(result.success).toBe(true);\n    > 152 |       expect(mockSearch).toHaveBeenCalledWith(\n          |                          ^\n      153 |         mockSessionId,\n      154 |         expect.objectContaining({\n      155 |           text: 'blood pressure concerns',\n\n      at Object.toHaveBeenCalledWith (__tests__/memory/search.test.ts:152:26)\n","name":"/home/ubuntu/biospark-health-ai/__tests__/memory/search.test.ts","startTime":1753378493796,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Memory Performance & Caching","Memory Cache"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching Memory Cache should cache and retrieve data correctly","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should cache and retrieve data correctly"},{"ancestorTitles":["Memory Performance & Caching","Memory Cache"],"duration":151,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching Memory Cache should respect TTL and expire data","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should respect TTL and expire data"},{"ancestorTitles":["Memory Performance & Caching","Memory Cache"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching Memory Cache should implement LRU eviction when cache is full","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should implement LRU eviction when cache is full"},{"ancestorTitles":["Memory Performance & Caching","withCache wrapper"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching withCache wrapper should cache operation results","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should cache operation results"},{"ancestorTitles":["Memory Performance & Caching","withCache wrapper"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching withCache wrapper should handle operation failures gracefully","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle operation failures gracefully"},{"ancestorTitles":["Memory Performance & Caching","Performance Requirements"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching Performance Requirements should meet <50ms response time requirement for cached operations","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should meet <50ms response time requirement for cached operations"},{"ancestorTitles":["Memory Performance & Caching","Performance Requirements"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching Performance Requirements should handle concurrent cache operations","invocations":1,"location":null,"numPassingAsserts":10,"retryReasons":[],"status":"passed","title":"should handle concurrent cache operations"},{"ancestorTitles":["Memory Performance & Caching","Cache Statistics"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Memory Performance & Caching Cache Statistics should provide cache statistics","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should provide cache statistics"}],"endTime":1753378494489,"message":"","name":"/home/ubuntu/biospark-health-ai/__tests__/memory/performance.test.ts","startTime":1753378494068,"status":"passed","summary":""}],"wasInterrupted":false}
